Major redesign of the 'formats' API; formats are now classes and can store data for their needs.